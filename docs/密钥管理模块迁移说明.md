# 密钥管理模块迁移说明

## 概述
将密钥管理功能从 `system` 包迁移到独立的 `secretkey` 包，使其成为一个独立的功能模块。

## 迁移时间
2026-01-06

## 变更内容

### 1. 后端变更

#### 1.1 包结构变更
- **原包路径**: `com.ruoyi.project.system`
- **新包路径**: `com.ruoyi.project.secretkey`

#### 1.2 类名变更
| 原类名 | 新类名 | 说明 |
|--------|--------|------|
| SysSecretKey | SecretKeyInfo | 实体类 |
| SysSecretKeyMapper | SecretKeyInfoMapper | Mapper接口 |
| ISysSecretKeyService | ISecretKeyInfoService | Service接口 |
| SysSecretKeyServiceImpl | SecretKeyInfoServiceImpl | Service实现类 |
| SysSecretKeyController | SecretKeyInfoController | Controller类 |

#### 1.3 数据库变更
- **原表名**: `sys_secret_key`
- **新表名**: `secret_key_info`

#### 1.4 API路径变更
- **原路径**: `/system/secretKey/*`
- **新路径**: `/secretkey/info/*`

#### 1.5 权限标识变更
- **原权限**: `system:secretKey:*`
- **新权限**: `secretkey:info:*`

### 2. 前端变更

#### 2.1 目录结构变更
- **原路径**: `src/views/system/secretKey/`
- **新路径**: `src/views/secretkey/info/`

#### 2.2 API文件变更
- **原路径**: `src/api/system/secretKey.js`
- **新路径**: `src/api/secretkey/info.js`

#### 2.3 组件名称变更
- **原组件名**: `SecretKey`
- **新组件名**: `SecretKeyInfo`

### 3. 受影响的文件

#### 3.1 后端文件
以下文件已更新引用：
- `com.ruoyi.project.aliyun.service.impl.RdsInstanceInfoServiceImpl`
- `com.ruoyi.common.utils.FeishuConfigUtils`
- `com.ruoyi.framework.aliyun.provider.AliyunCredentialProvider`

#### 3.2 前端文件
- 新建: `src/api/secretkey/info.js`
- 新建: `src/views/secretkey/info/index.vue`
- 删除: `src/api/system/secretKey.js`
- 删除: `src/views/system/secretKey/`

## 迁移步骤

### 步骤1: 执行数据库迁移
```sql
-- 1. 重命名表
source sql/migration_rename_secret_key_table.sql

-- 2. 更新菜单权限
source sql/update_secretkey_menu.sql
```

### 步骤2: 部署后端代码
1. 删除旧的 system 包下的密钥管理类
2. 部署新的 secretkey 包代码
3. 重启应用

### 步骤3: 部署前端代码
1. 删除旧的前端文件
2. 部署新的前端文件
3. 清除浏览器缓存

### 步骤4: 验证功能
1. 登录系统
2. 访问密钥管理菜单
3. 测试增删改查功能
4. 验证权限控制

## 注意事项

1. **数据库备份**: 执行迁移前请务必备份数据库
2. **权限更新**: 迁移后需要重新分配用户权限
3. **缓存清理**: 建议清理Redis缓存和浏览器缓存
4. **API调用**: 如有外部系统调用密钥管理API，需要更新调用路径

## 回滚方案

如需回滚，请执行以下步骤：

### 数据库回滚
```sql
-- 回滚表名
RENAME TABLE secret_key_info TO sys_secret_key;

-- 回滚菜单（需要根据备份恢复）
-- 建议在执行迁移前备份 sys_menu 表
```

### 代码回滚
1. 恢复到迁移前的代码版本
2. 重启应用

## 相关文件清单

### SQL脚本
- `sql/migration_rename_secret_key_table.sql` - 表重命名脚本
- `sql/update_secretkey_menu.sql` - 菜单更新脚本

### 后端新增文件
- `src/main/java/com/ruoyi/project/secretkey/domain/SecretKeyInfo.java`
- `src/main/java/com/ruoyi/project/secretkey/mapper/SecretKeyInfoMapper.java`
- `src/main/java/com/ruoyi/project/secretkey/service/ISecretKeyInfoService.java`
- `src/main/java/com/ruoyi/project/secretkey/service/impl/SecretKeyInfoServiceImpl.java`
- `src/main/java/com/ruoyi/project/secretkey/controller/SecretKeyInfoController.java`

### 后端删除文件
- `src/main/java/com/ruoyi/project/system/domain/SysSecretKey.java`
- `src/main/java/com/ruoyi/project/system/mapper/SysSecretKeyMapper.java`
- `src/main/java/com/ruoyi/project/system/service/ISysSecretKeyService.java`
- `src/main/java/com/ruoyi/project/system/service/impl/SysSecretKeyServiceImpl.java`
- `src/main/java/com/ruoyi/project/system/controller/SysSecretKeyController.java`

### 前端新增文件
- `src/api/secretkey/info.js`
- `src/views/secretkey/info/index.vue`

### 前端删除文件
- `src/api/system/secretKey.js`
- `src/views/system/secretKey/index.vue`

## 测试检查清单

- [ ] 数据库表重命名成功
- [ ] 菜单权限更新成功
- [ ] 密钥管理列表查询正常
- [ ] 新增密钥功能正常
- [ ] 修改密钥功能正常
- [ ] 删除密钥功能正常
- [ ] 导出功能正常
- [ ] 飞书密钥下拉选项正常
- [ ] 阿里云凭证获取正常
- [ ] RDS实例同步功能正常
- [ ] 权限控制正常

## 联系人
如有问题，请联系开发团队。
